FROM node:20.19.0-alpine3.21@sha256:8bda036ddd59ea51a23bc1a1035d3b5c614e72c01366d989f4120e8adca196d4
WORKDIR /app

# Frontend files will be provided by Goreleaser
COPY vmwiz-frontend/ ./

ENV VMWIZ_SCHEME=https
ENV VMWIZ_HOSTNAME=vmwiz.vsos.ethz.ch
ENV VMWIZ_PORT=443
ENV NODE_ENV=production 

RUN yarn install
RUN yarn run build

FROM node:20.19.0-alpine3.21@sha256:8bda036ddd59ea51a23bc1a1035d3b5c614e72c01366d989f4120e8adca196d4
COPY --from=build /app/dist /usr/share/nginx/html
WORKDIR /usr/share/nginx/html
