FROM node:20.18.1-alpine3.21@sha256:24fb6aa7020d9a20b00d6da6d1714187c45ed00d1eb4adb01395843c338b9372 AS build
WORKDIR /app

# Frontend files will be provided by Goreleaser
COPY vmwiz-frontend/ ./

ENV VMWIZ_SCHEME=https
ENV VMWIZ_HOSTNAME=vmwiz.vsos.ethz.ch
ENV VMWIZ_PORT=443
ENV NODE_ENV=production 

RUN npm install
RUN npm run build

FROM nginx:alpine@sha256:1d13701a5f9f3fb01aaa88cef2344d65b6b5bf6b7d9fa4cf0dca557a8d7702ba
COPY --from=build /app/dist /usr/share/nginx/html
WORKDIR /usr/share/nginx/html
